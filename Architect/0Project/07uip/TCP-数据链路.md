# TCP-数据链路
---

## 1 数据链路作用
> &nbsp; &nbsp; &nbsp; &nbsp;数据链路层定义了通过通信媒介互联之间的传输规范，其中包括双绞线、同轴电缆、光钎、电波及红外线等

## 2 数据链路的相关技术
### 2.1 MAC地址
> &nbsp; &nbsp; &nbsp; &nbsp;MAC地址长48bits，任何一个网卡的MAC地址都是唯一的，在全世界都不会重复。
> 
> * 第1位&nbsp; &nbsp; &nbsp; &nbsp; ：单播地址（0）/多播地址（1）
> * 第2位&nbsp; &nbsp; &nbsp; &nbsp; ：全局地址（0）/本地地址（1）
> * 第3-24位&nbsp; &nbsp;：由IEEE管理，保证各个厂家之间不重复
> * 第25-48位&nbsp;：由厂家管理，保证各个产品之间不重复

### 2.2 共享介质网络
> &nbsp; &nbsp; &nbsp; &nbsp;共享介质网络是指多个设备共享一个通信介质的一种网络，早期的以太网和FDDI就是该种类型。设备之间使用同一个载波信道进行发送和接收。为此，基本上采用半双工通信，并有必要对介质进行访问控制（争用方式、令牌传递）。

- 争用方式
>  &nbsp; &nbsp; &nbsp; &nbsp;争夺获取传输数据的权力，也叫CSMA（载波监听多路访问），实际就是先到先得，如果多路同时竞争，则会产生冲突现象，导致网络拥堵性能下降。
>
>  &nbsp; &nbsp; &nbsp; &nbsp;改良CSMA - CSMA/CD，要求每个站提前检测冲突， 一旦发生冲突，则尽早释放信道，具体原理如下：
> 
> * 如果载波信道上没有数据流动，任何站都可以发送数据。
> * 检测是否发生冲突。一旦发生冲突，放弃发送数据同时立即释放载波信道。
> * 放弃发送以后，随机时延一段时间，再重新争用介质，重新发送帧。

- 令牌传递 
>  &nbsp; &nbsp; &nbsp; &nbsp;令牌传递方式是沿着令牌环发送“令牌”报文，只有获取到了令牌的站才能发送数据。

### 2.3 非共享介质网络
>  &nbsp; &nbsp; &nbsp; &nbsp;网络中所有设备都是直连交换机，由交换机负责转发数据帧，发送端和接收端并不共享介质，因此采用全双工通信方式。

### 2.4 根据MAC地址转发
> * 以太网交换机就是持有多个端口的网桥。
> * 转发表，根据数据链路层每个帧的MAC地址决定哪个网络接口的记录表

### 2.5 环路检测技术
> * 当对个网桥连接成环路的时候：
::: mermaid
graph LR;
    交换机A-.-计算机A;
    交换机A-.-交换机B;
    交换机B-.-交换机C;
    交换机C-.-计算机B;
    交换机C-.-交换机D;
    交换机A-.-交换机D
:::
>  &nbsp; &nbsp; &nbsp; &nbsp;交换机在转发数据帧的时候，会<mark>**将数据帧拷贝给相邻的链路**</mark>，所以上图中如果计算机A要发数据给计算机B的时候，会导致数据在网络中被循环转发。
> 
> * 生成树方式，在固定间隔时间内相互交换BPDU（Bridge Protocol Data Unit）包，从而判断哪些端口未使用，以便消除环路。一旦发生故障，则自动切换线路。
> * 源路由法，判断发送数据的源地址是从哪个网桥进行传输的，并写入RIF（Routing Information Filed）。网桥根据RIF信息发送帧给目标地址。

### 2.6 VLAN
>  &nbsp; &nbsp; &nbsp; &nbsp;实际上就是将一个网桥分隔成两个不同的网段。交换机在传输帧的时候在以太网首部加入<mark>**VLAN ID标签**</mark>，根据这个值决定将数据帧发送给相应的网段。

## 3 以太网
### 3.1 连接形式
> * 初期的以太网连接形式采用共享介质型连接。
> * 目前多采用终端与交换机独占电缆的方式。

### 3.2 以太网帧格式
> * 前导码（Preamble），由0、1数字交替组合而成，表示以太网帧的开始，也是对端网卡能够确保与其同步的标志。SFD（Start Frame Delimiter）其值是11，表示前导码结束。总共8个字节。
> * 以太网帧体格式：
> 
|  目标MAC地址（6字节）   | 源MAC地址（6字节）  | 类型（2字节） | 数据（46～1500）字节 |FSC（4字节）|
|  ----  | ----  |----  |----  |----  |
> * IEEE802.3以太网帧体格式：
> 
|  目标MAC地址（6字节）   | 源MAC地址（6字节）  | 帧长度（2字节） | LLC（3字节） | SNAP（5字节） | 数据（38～1500）字节 | FSC（4字节） |
|  ----  | ----  |----  |----  |----  |----  |----  |

> * 带有VLAN标记的交换机之间流动的  以太网帧体格式：
> 
> VLAN中追加的字段(类型、优先度、CFI、VLAN ID)
> 
|  目标MAC地址（6字节）   | 源MAC地址（6字节）  | VLAN中追加的字段 | 类型（2字节） | 数据（46～1500）字节 |FSC（4字节）|
|  ----  | ----  |----  |----  |----  |----  |
