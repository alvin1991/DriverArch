# IP协议
> &nbsp; &nbsp; &nbsp; &nbsp;TCP/IP 的心脏是是互联网层。这一层主要是由IP（Internet Protocol）和ICMP（Internet Control Message Protocol）两个协议组成。

## IP协议作用
> * IP(IPv4、IPv6)相当于OSI参考模型中的第三层---网络层。
> * 主要作用是”实现终端节点之间的通信“，这种节点之间的通信也叫”点对点通信“。

>### 主机与路由器
> * 主机，配有IP地址，但是不进行路由控制的设备。
> * 路由器，配有IP地址，具有路由控制能力的设备。
> * 节点，是主机和路由器的统称。

>### 网络层和数据链路层的关系
> * 数据链路层提供直连两个设备之间的通信功能。
> * 网络层是负责没有直连的两个网络之间进行通信传输。

## IP基础知识
> &nbsp; &nbsp; &nbsp; &nbsp;不论主机采用的哪种数据链路（以太网、无线局域网、PPP等）连接，其IP地址形式保持不变。
> ### 路由控制（Routing）
> 将分组数据发送到最终目标地址的功能。
> * 发送数据到最终目标地址，Hop（一跳），是指路由器网卡或主机不经过其他路由器**直接到达**相邻的主机或者路由器网卡之间的一个区间。
> * 路由控制表，所有主机都维护着一张路由表（Routing Table），记录了IP数据在下一步应该发送给哪个路由器
> * 多跳路由，是指路由器或主机在转发IP数据包时只指定下一个路由器或主机，而不是将最终目标地址为止的所有通路全部指定出来，直至包达到最终的目的地址。
> 
> ### 数据链路的抽象化
> &nbsp; &nbsp; &nbsp; &nbsp;数据链路层的数据种类和特性不尽相同，例如各自的最大传输单元也不尽相同（以太网 MTU = 1500、FDDI MTU = 4352、ATM MTU = 9180），IP需要进行分片处理（IP Fragmentation），将较大的包分隔成较小的包，分片的包到了对端目标地址以后会再组合成完整的数据包，交由上一层继续处理。
> 
> ### IP属于面向无连接型
> * 无需建立连接，即使对端主机关机或者不存在，数据也会被压缩成IP包发送出去。

> ### IP地址分类
> * A类：0.0.0.0～127.0.0.0，一个网段可容纳主机的上限16777214（0xffffff）个
> * B类：128.0.0.0～191.255.0.0，一个网段可容纳主机的上限65535（0xffff）个
> * C类：192.168.0.0～239.255.255.0，一个网段可容纳主机的上限254（0xff）个
> * D类：224.0.0.0～239.255.255.255，地址没有主机标识，常用于多播。

> ### 广播地址
> &nbsp; &nbsp; &nbsp; &nbsp;广播地址分为本地广播和直接广播。
> * 本地广播，指在本网络内的广播，例如在192.168.0.0/24的情况下，本地广播地址为192.168.0.255，这个IP地址的IP包或被路由器屏蔽，所以不会到达192.168.0.0/24以外的链路上。
> * 直接广播，不同网络之间的广播，例如192.168.0.0/24的主机向192.168.1.255/24的目标地址发送IP包，收到这个包的路由器，将数据转发给192.168.1.0/24，从而使得192.168.1.1/24～192.168.1.254/24的主机都能收到这个包。

> ### IP多播
> #### 同时发送提高效率
> &nbsp; &nbsp; &nbsp; &nbsp;多播用于将IP包发送给特定组内的所有主机，由于直接使用IP协议，因此也存在不可靠传输。这样相对于采用广播的方式减少了很多不必要的流量。
> #### IP多播与地址
> &nbsp; &nbsp; &nbsp; &nbsp;多播使用D类地址，IP地址首位开始到第4位是“1110”就可以认为是多播地址。剩下的28位就可以称为多播组编号

> #### IP分隔处理与再构成处理
> ##### 数据链路不同，MTU则异
> &nbsp; &nbsp; &nbsp; &nbsp;IP需要抽象化底层数据链路层，适应不同的数据链路层；
> IP最大传输单元大小：65535，IP最小传输单元大小：68
> ##### IP报文的分片与重组
> &nbsp; &nbsp; &nbsp; &nbsp;经过分片后的IP报文在被重组的时候只能由目标主机完成，路由器虽然做分片，但是不会进行重组。
> 
> ### IP首部
> 版本（4bytes）<br>
> +首部长度（4bytes，包含至载荷前的所有数据）<br>
> +区分服务TOS（8bytes）<br>
> +总长度（16bytes，IP首部加数据部分合起来总的字节数，所以IP包最大长度65535）<br>
> +标识（16bytes，用于分片，不同分片标识值不同，且逐渐增加）<br>
> +标志（3bytes，标志是否分片，是否为分片最后一包）<br>
> +片偏移（13bytes，分片每一片相对于原始数据位置）<br>
> +生存时间TTL（8bytes，实际指可以中转多少个路由器的意思）<br>
> +协议（8bytes，表示IP首部的下一个首部隶属于哪个协议）<br>
> +首部校验和（16bytes）<br>
> +源地址（32bytes）<br>
> +目标地址（32bytes）<br>
> +可选字段（长度可变，实验或诊断使用）<br>
> +填充（填充使首部长度是32字节的整数倍）
> 
> 